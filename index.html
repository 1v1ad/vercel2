<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GG Room</title>
  <style>
    :root{
      --bg:#0b0d12; --bg2:#11151d; --card:#000000; --text:#e8eaf0; --muted:#98a2b3;
      --vk:#2787F5; --tg:#2AABEE;
      --gold:#f4d88a; --gold-strong:#ffd76a;
      --border:rgba(255,255,255,.06); --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(1200px 600px at 50% -10%, #171b24 0%, #0b0d12 55%, #090b10 100%);
      color:var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:flex; flex-direction:column;
    }
    header{display:flex; justify-content:center; padding:14px 16px; border-bottom:1px solid var(--border)}
    header b{
      /* +25% —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ—Ç–∏–ø–∞ */
      font-size: 1.25rem;
      letter-spacing:.4px; font-weight:800
    }
    header b .gg{
      /* –ì—Ä–∞–¥–∏–µ–Ω—Ç GG: –∫—Ä–∞—Å–Ω—ã–π ‚Üí –∑–µ–ª—ë–Ω—ã–π */
      background: linear-gradient(90deg, #ff3b3b, #23d160);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      
    }
    main{flex:1; display:grid; place-items:center; padding:32px}
    .hero{
      width:min(1100px, 100%); display:grid; grid-template-columns:repeat(12, 1fr); gap:18px;
      align-items:stretch;
    }
    .card{
      grid-column:span 8; background:linear-gradient(180deg, #0f131b 0%, #0a0c12 100%);
      border-radius:var(--radius); border:1px solid var(--border); padding:22px 18px 16px;
      box-shadow:0 40px 100px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
    }
    .card h1{ margin:0 0 8px; font-size:28px; line-height:1.25 }
    .lead{ color:var(--muted); margin:0 0 18px }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:#0f141c; color:#c4cbd6; font-size:.9rem }
    .actions{ display:flex; gap:12px; flex-wrap:wrap; margin:18px 0 }
    .btn{
      display:inline-flex; align-items:center; gap:10px; padding:13px 16px; border-radius:12px;
      background:#121722; border:1px solid var(--border); color:#e8eaf0; text-decoration:none; cursor:pointer;
      transition:.15s transform, .15s background;
    }
    .btn:hover{ transform:translateY(-1px); background:#182034 }
    .btn.vk{ background:rgba(39,135,245,.08); border-color:rgba(39,135,245,.25) }
    .btn.vk:hover{ background:rgba(39,135,245,.14) }
    .btn.tg{ background:rgba(42,171,238,.08); border-color:rgba(42,171,238,.25) }
    .btn.tg:hover{ background:rgba(42,171,238,.14) }

    .side{
      grid-column:span 4; border-radius:var(--radius);
      border:1px solid var(--border); background:linear-gradient(180deg, #0f141b 0%, #0b0d12 100%);
      padding:18px;
    }
    .mini{ color:#c4cbd6; font-size:.95rem; line-height:1.4; }
    .muted{ color:var(--muted) }
    .list{ display:grid; gap:10px; margin:12px 0 0 }
    .list .item{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:#0f141c; border:1px solid var(--border); border-radius:12px; padding:10px 12px;
    }
    .item .tag{ color:#a9b2c2; font-size:12px; border:1px solid var(--border); padding:2px 6px; border-radius:8px }
    .foot{ margin-top:18px; color:#8d98a8; font-size:12px }

    @media (max-width: 960px){
      .card{ grid-column: span 12 }
      .side{ grid-column: span 12 }
    }
  </style>
</head>
<body>
  <header>
    <b><span class="gg">GG</span>Room</b>
  </header>

  <main>
    <section class="hero">
      <div class="card">
        <div class="pill">üí´ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</div>
        <h1>–û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∏ –≤—ã –≤ –∏–≥—Ä–µ</h1>
        <p class="lead">–í—Ö–æ–¥ —á–µ—Ä–µ–∑ VK ID –∏–ª–∏ Telegram. –ë–µ–∑ –ø–∞—Ä–æ–ª–µ–π, –∫–æ–¥—ã –Ω–µ –Ω—É–∂–Ω—ã ‚Äî —Å–∫–ª–µ–π–∫–∞ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É.</p>

        <div class="actions">
          <button id="vk-login" class="btn vk">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ VK ID</button>
          <span id="tg-auth" class="btn tg" style="padding:0; border:none; background:transparent"></span>
        </div>

        <div class="muted" id="status">–ì–æ—Ç–æ–≤—ã? –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∏–∑ –∫–Ω–æ–ø–æ–∫.</div>
      </div>

      <aside class="side">
        <div class="mini">–ß—Ç–æ –¥–∞–ª—å—à–µ?</div>
        <div class="list">
          <div class="item"><div>1) –ê–≤—Ç–æ—Ä–∏–∑—É–µ–º –≤–∞—Å</div><div class="tag">15 —Å–µ–∫</div></div>
          <div class="item"><div>2) –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî –ø—Ä—è–º–æ –∫–∞—Ä—Ç–æ–π</div><div class="tag">–º–∏–Ω—É—Ç–∫–∞</div></div>
          <div class="item"><div>3) –ö–æ–º–Ω–∞—Ç—ã, —Ç—É—Ä–Ω–∏—Ä—ã, –ª–æ—Ç–µ—Ä–µ–∏</div><div class="tag">üî• —Å–∫–æ—Ä–æ</div></div>
        </div>
        <div class="foot">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: VK ID, Telegram. –ë–∞–ª–∞–Ω—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è —É –Ω–∞—Å ‚Äî –±–µ–∑ –±–æ–ª–∏ –∏ –ø–∞—Ä–æ–ª–µ–π.</div>
      </aside>
    </section>
  </main>

  <script>
    /* –ö–æ–Ω—Ñ–∏–≥ */
    const API = 'https://vercel2pr.onrender.com';
    const TG_BOT_ID = 8236271394;

    /* üëá –ù–æ–≤—ã–π –±–ª–æ–∫: device_id –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π —Å–∫–ª–µ–π–∫–∏ */
    const DEVICE_ID_KEY = 'gg_device_id';
    function uuid4() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        const r = crypto.getRandomValues(new Uint8Array(1))[0] & 15;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }
    function ensureDeviceId() {
      let did = localStorage.getItem(DEVICE_ID_KEY);
      if (!did) { did = uuid4(); localStorage.setItem(DEVICE_ID_KEY, did); }
      return did;
    }
    const DEVICE_ID = ensureDeviceId();

    document.getElementById('vk-login').onclick = () => {
      window.location.href = API + '/api/auth/vk/start?did=' + encodeURIComponent(DEVICE_ID);
    };

    async function warmAndMountTg() {
      try { await fetch(API + '/health', { cache: 'no-store' }); } catch {}
      setTimeout(() => {
        if (document.getElementById('tg-widget')) return;
        const s = document.createElement('script');
        s.id = 'tg-widget';
        s.async = true;
        s.src = 'https://telegram.org/js/telegram-widget.js?22';
        s.setAttribute('data-telegram-login', 'GGR00m_bot');
        s.setAttribute('data-size', 'large');
        s.setAttribute('data-userpic', 'false');
        s.setAttribute('data-request-access', 'write');
        /* üëá –ü–µ—Ä–µ–¥–∞—ë–º device_id –Ω–∞ –±—ç–∫–µ–Ω–¥ */
        s.setAttribute('data-auth-url', API + '/api/auth/tg/callback?did=' + encodeURIComponent(DEVICE_ID));
        const mount = document.getElementById('tg-auth');
        if (mount) mount.appendChild(s);
        setTimeout(() => {
          const hasIframe = !!mount?.querySelector('iframe');
          if (!hasIframe) {
            const fb = document.getElementById('tg-fallback');
            if (fb) fb.style.display = 'flex';
          }
        }, 1200);
      }, 200);
    }
    warmAndMountTg();

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const vk = document.getElementById('vk-login');
        if (vk) vk.click();
      }
    });

    (function handleLoggedRedirect(){
      const params = new URLSearchParams(location.search);
      if (params.get('logged') === '1') {
        const st = document.getElementById('status');
        if (st) st.textContent = '–ì–æ—Ç–æ–≤–æ: –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ª–æ–±–±–∏...';
        setTimeout(() => {
          window.location.href = '/lobby.html' + location.search;
        }, 400);
      }
    })();
  </script>
</body>
</html>
