<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/>
<meta content="https://vercel2pr.onrender.com" name="api-base"/>
<meta content="8236271394" name="tg-bot-id"/>
<title>GG ROOM — Лобби</title>
<link href="/assets/favicon.svg" rel="icon" type="image/svg+xml"/>
<link href="/assets/favicon-32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/assets/favicon-16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/assets/favicon.ico" rel="shortcut icon"/>
<link href="/assets/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/assets/site.webmanifest" rel="manifest"/>
<link href="/css/ui-tokens.css" rel="stylesheet"/>

<style>
/* ═══════════════════════════════════════════════
   RESET & BASE
═══════════════════════════════════════════════ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0b0d12;
  --surface: #0f1219;
  --card: #121621;
  --card-2: #161c28;
  --text: #e8eaf0;
  --muted: #6b7280;
  --muted-2: #98a2b3;
  --border: rgba(255,255,255,.07);
  --border-2: rgba(255,255,255,.12);
  --accent: #2dd4bf;
  --accent-dim: rgba(45,212,191,.12);
  --gold: #f4d88a;
  --gold-dim: rgba(244,216,138,.12);
  --gold-border: rgba(244,216,138,.30);
  --good: #34d399;
  --bad: #f87171;
  --radius: 16px;
  --radius-sm: 10px;
  --radius-xs: 8px;

  /* Safe area insets for notch phones */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);

  /* Layout constants */
  --hdr-h: 60px;
  --tab-h: 60px;
}

html {
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  min-height: 100dvh;
  overflow-x: hidden;
  /* Reserve space for fixed header + bottom tab bar */
  padding-top: calc(var(--hdr-h) + var(--safe-top));
  padding-bottom: calc(var(--tab-h) + var(--safe-bottom));
  padding-left: var(--safe-left);
  padding-right: var(--safe-right);
}

/* Scrollbar */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,.12); border-radius: 4px; }

/* ═══════════════════════════════════════════════
   TOP HEADER — compact, sticky, mobile-native
═══════════════════════════════════════════════ */
.hdr {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 100;
  height: calc(var(--hdr-h) + var(--safe-top));
  padding-top: var(--safe-top);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-left: 14px;
  padding-right: 14px;
  background: linear-gradient(180deg, rgba(11,13,18,.98) 0%, rgba(11,13,18,.92) 100%);
  backdrop-filter: blur(20px) saturate(1.6);
  -webkit-backdrop-filter: blur(20px) saturate(1.6);
  border-bottom: 1px solid var(--border);
}

/* Brand */
.hdr-brand {
  display: flex;
  align-items: center;
  gap: 2px;
  font-size: 18px;
  font-weight: 900;
  letter-spacing: -.3px;
  text-decoration: none;
}
.hdr-brand .gg {
  background: linear-gradient(135deg, #ff4444 0%, #ff8800 50%, #2dd4bf 100%);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}
.hdr-brand .room { color: var(--text); }

/* Balance chip — главный элемент шапки для игрока */
.hdr-balance {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 7px 12px;
  border-radius: 999px;
  background: rgba(244,216,138,.08);
  border: 1px solid var(--gold-border);
  cursor: default;
  user-select: none;
  transition: transform .15s ease;
  -webkit-tap-highlight-color: transparent;
}
.hdr-balance:active { transform: scale(.96); }

.hdr-balance-icon {
  font-size: 14px;
  line-height: 1;
}
.hdr-balance-amount {
  font-size: 15px;
  font-weight: 900;
  color: var(--gold);
  font-variant-numeric: tabular-nums;
  letter-spacing: .2px;
  min-width: 20px;
}
.hdr-balance-label {
  font-size: 10px;
  color: rgba(244,216,138,.5);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .08em;
}

/* Avatar */
.hdr-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  background: var(--card-2);
  border: 2px solid var(--border-2);
  flex-shrink: 0;
}

.hdr-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* User name — скрыт на мобиле, виден на десктопе */
.hdr-name {
  display: none;
  font-size: 13px;
  font-weight: 700;
  max-width: 120px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Topup button */
.btn-topup {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 7px 12px;
  border-radius: 999px;
  border: 1px solid rgba(45,212,191,.35);
  background: rgba(45,212,191,.08);
  color: var(--accent);
  font-size: 13px;
  font-weight: 800;
  text-decoration: none;
  cursor: pointer;
  transition: background .15s, transform .12s;
  -webkit-tap-highlight-color: transparent;
  white-space: nowrap;
}
.btn-topup:active { transform: scale(.95); background: rgba(45,212,191,.14); }
.btn-topup svg { flex-shrink: 0; }

/* Link buttons (hidden by default, shown by JS) */
#link-tg, #link-vk { display: none !important; }

/* ═══════════════════════════════════════════════
   BOTTOM TAB BAR — главная мобильная навигация
═══════════════════════════════════════════════ */
.tab-bar {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  z-index: 100;
  height: calc(var(--tab-h) + var(--safe-bottom));
  padding-bottom: var(--safe-bottom);
  display: flex;
  align-items: stretch;
  background: rgba(11,13,18,.96);
  backdrop-filter: blur(20px) saturate(1.6);
  -webkit-backdrop-filter: blur(20px) saturate(1.6);
  border-top: 1px solid var(--border);
}

.tab-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  padding: 8px 4px;
  text-decoration: none;
  color: var(--muted);
  cursor: pointer;
  background: none;
  border: none;
  outline: none;
  -webkit-tap-highlight-color: transparent;
  transition: color .18s ease;
  position: relative;
  overflow: hidden;
  font-family: inherit;
}

.tab-item::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at 50% 100%, rgba(45,212,191,.12), transparent 70%);
  opacity: 0;
  transition: opacity .2s ease;
}
.tab-item.is-active::before { opacity: 1; }
.tab-item.is-active { color: var(--accent); }
.tab-item.is-active .tab-icon { color: var(--accent); }

.tab-icon {
  width: 22px;
  height: 22px;
  color: inherit;
  flex-shrink: 0;
  transition: transform .2s cubic-bezier(.34,1.56,.64,1);
}
.tab-item.is-active .tab-icon { transform: scale(1.1); }

.tab-label {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: .03em;
  line-height: 1;
}

.tab-badge {
  position: absolute;
  top: 6px;
  right: calc(50% - 16px);
  min-width: 16px;
  height: 16px;
  padding: 0 4px;
  border-radius: 999px;
  background: var(--bad);
  color: #fff;
  font-size: 9px;
  font-weight: 900;
  display: flex;
  align-items: center;
  justify-content: center;
  display: none;
}
.tab-badge.visible { display: flex; }

/* ═══════════════════════════════════════════════
   MAIN SCROLL CONTENT
═══════════════════════════════════════════════ */
.wrap {
  max-width: 640px;
  margin: 0 auto;
  padding: 12px 12px 8px;
}

/* Section panels — hubs */
.hub { display: none; }
.hub.is-active { display: block; }

/* Section title row */
.section-hd {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin: 16px 0 10px;
}
.section-hd:first-child { margin-top: 4px; }
.section-title {
  font-size: 17px;
  font-weight: 800;
  letter-spacing: -.2px;
}
.section-sub {
  font-size: 12px;
  color: var(--muted-2);
  font-weight: 600;
}

/* ═══════════════════════════════════════════════
   WELCOME BANNER
═══════════════════════════════════════════════ */
.welcome {
  position: relative;
  overflow: hidden;
  border-radius: var(--radius);
  padding: 14px 16px;
  background: linear-gradient(135deg, rgba(10,132,255,.18) 0%, rgba(45,212,191,.10) 60%, rgba(0,0,0,.0) 100%);
  border: 1px solid rgba(45,212,191,.15);
  margin-bottom: 14px;
}
.welcome::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(110deg,
    transparent 0%,
    rgba(45,212,191,.06) 40%,
    rgba(244,216,138,.06) 70%,
    transparent 100%);
  background-size: 200% 100%;
  animation: welcomeShimmer 5s linear infinite;
  pointer-events: none;
}
@keyframes welcomeShimmer {
  0% { background-position: -100% 0; }
  100% { background-position: 200% 0; }
}
.welcome-text {
  position: relative;
  z-index: 1;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  line-height: 1.4;
}
.welcome-sub {
  position: relative;
  z-index: 1;
  margin-top: 3px;
  font-size: 12px;
  color: var(--muted-2);
}
#provider-note { margin: 0; font-size: 12px; color: var(--muted-2); }

/* ═══════════════════════════════════════════════
   STAKE CARDS — горизонтальный скролл на мобиле
═══════════════════════════════════════════════ */
.stakes-scroll {
  margin: 0 -12px;
  padding: 0 12px;
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
  scrollbar-width: none;
  display: flex;
  gap: 10px;
  padding-bottom: 4px;
}
.stakes-scroll::-webkit-scrollbar { display: none; }

.stake-card {
  scroll-snap-align: start;
  flex-shrink: 0;
  width: 200px;
  border-radius: var(--radius);
  border: 1px solid var(--border-2);
  background: linear-gradient(160deg, var(--card-2) 0%, rgba(10,12,20,.95) 100%);
  padding: 14px;
  position: relative;
  overflow: hidden;
  cursor: pointer;
  transition: border-color .2s, transform .18s cubic-bezier(.34,1.56,.64,1), box-shadow .2s;
  -webkit-tap-highlight-color: transparent;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.stake-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 60px;
  background: radial-gradient(ellipse at 50% -10%, rgba(244,216,138,.10), transparent 70%);
  pointer-events: none;
}

.stake-card:active { transform: scale(.97); }
.stake-card.is-selected {
  border-color: var(--gold-border);
  box-shadow: 0 0 0 1px rgba(244,216,138,.12) inset,
              0 8px 24px rgba(0,0,0,.3);
}
.stake-card.is-selected::before {
  background: radial-gradient(ellipse at 50% -10%, rgba(244,216,138,.18), transparent 70%);
}

/* VIP card */
.stake-card.stake-vip { opacity: .6; cursor: default; border-color: rgba(186,141,255,.2); }
.stake-card.stake-vip::before {
  background: radial-gradient(ellipse at 50% -10%, rgba(186,141,255,.12), transparent 70%);
}

/* Stake amount */
.stake-amt {
  font-size: 22px;
  font-weight: 900;
  letter-spacing: -.5px;
  color: var(--gold);
  line-height: 1;
}

/* Fake gold text shimmer */
@supports ((-webkit-background-clip: text) or (background-clip: text)) {
  .stake-amt {
    background: linear-gradient(90deg,
      #d4a843 0%, #f4d88a 25%, #fff8d4 50%, #f4d88a 75%, #d4a843 100%);
    background-size: 200% 100%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: goldShimmer 3s linear infinite;
  }
  .stake-card.stake-vip .stake-amt {
    background: linear-gradient(90deg, #9b6edc, #c4a0ff, #9b6edc);
    background-size: 200% 100%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }
}
@keyframes goldShimmer {
  0% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

.stake-meta {
  font-size: 11px;
  color: var(--muted);
  font-weight: 600;
  line-height: 1.3;
  margin-top: -4px;
}

/* Live indicator */
.stake-live {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
  color: var(--muted);
  font-weight: 700;
}
.stake-live-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: rgba(244,216,138,.5);
  flex-shrink: 0;
}
.stake-live.is-on { color: var(--accent); }
.stake-live.is-on .stake-live-dot {
  background: var(--accent);
  box-shadow: 0 0 0 3px rgba(45,212,191,.15);
  animation: dotPulse 1.8s ease-in-out infinite;
}
@keyframes dotPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3); box-shadow: 0 0 0 5px rgba(45,212,191,.08); }
}

/* Badge overlay (HOT/LIVE/VIP) */
.stake-badge {
  position: absolute;
  top: 10px; right: 10px;
  display: none;
  padding: 3px 8px;
  border-radius: 999px;
  font-size: 10px;
  font-weight: 900;
  letter-spacing: .08em;
  text-transform: uppercase;
}
.stake-card.has-badge .stake-badge { display: block; }
.badge-live { background: rgba(45,212,191,.15); border: 1px solid rgba(45,212,191,.3); color: #8ff3df; }
.badge-hot { background: rgba(244,216,138,.15); border: 1px solid rgba(244,216,138,.35); color: var(--gold); }
.badge-vip { background: rgba(186,141,255,.12); border: 1px solid rgba(186,141,255,.3); color: #c4a0ff; }

/* Stake action buttons */
.stake-actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  margin-top: auto;
}
.stake-actions .btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 9px 6px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.04);
  color: var(--muted-2);
  font-size: 12px;
  font-weight: 800;
  cursor: pointer;
  transition: background .15s, color .15s, transform .12s;
  -webkit-tap-highlight-color: transparent;
  white-space: nowrap;
  font-family: inherit;
}
.stake-actions .btn:active { transform: scale(.95); }
.stake-actions .btn:disabled { opacity: .4; cursor: not-allowed; transform: none; }
.stake-actions .btn.primary {
  background: rgba(244,216,138,.08);
  border-color: rgba(244,216,138,.25);
  color: var(--gold);
}
.stake-actions .btn.primary:active { background: rgba(244,216,138,.14); }

/* Mode pill */
.mode-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 10px;
  padding: 0 2px;
}
.mode-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 5px 10px;
  border-radius: 999px;
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.04);
  font-size: 12px;
  font-weight: 800;
  color: var(--text);
}
.mode-pill .tag {
  font-size: 10px;
  font-weight: 900;
  padding: 2px 7px;
  border-radius: 999px;
  border: 1px solid rgba(45,212,191,.3);
  background: rgba(45,212,191,.10);
  color: #8ff3df;
  letter-spacing: .05em;
}
.mode-link {
  font-size: 12px;
  color: var(--muted);
  text-decoration: none;
  border-bottom: 1px dashed rgba(255,255,255,.15);
  padding-bottom: 1px;
  cursor: pointer;
  background: none;
  border-top: none;
  border-left: none;
  border-right: none;
  font-family: inherit;
}

/* ═══════════════════════════════════════════════
   REFRESH BUTTON
═══════════════════════════════════════════════ */
.btn-refresh {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 7px 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.04);
  color: var(--muted-2);
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: background .15s, transform .12s;
  font-family: inherit;
}
.btn-refresh:active { transform: scale(.95); background: rgba(255,255,255,.07); }

/* ═══════════════════════════════════════════════
   DUEL ITEMS — live list
═══════════════════════════════════════════════ */
.duels-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: relative;
}

.duel-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px 14px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: var(--card);
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: border-color .15s, background .15s;
  min-height: 64px;
}
.duel-item:active { background: var(--card-2); border-color: var(--border-2); }

.duel-left {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
  flex: 1;
}

.duel-avatars {
  display: flex;
  flex-shrink: 0;
}
.duel-avatars img {
  width: 36px; height: 36px;
  border-radius: 10px;
  object-fit: cover;
  background: var(--card-2);
  border: 1px solid var(--border-2);
}
.duel-avatars img + img { margin-left: -10px; }
.duel-avatars img.ph { opacity: .4; filter: saturate(.3); }

.duel-info { min-width: 0; flex: 1; }
.duel-title {
  font-size: 14px;
  font-weight: 800;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.duel-sub {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 2px;
  flex-wrap: wrap;
}
.duel-id {
  font-size: 11px;
  color: var(--muted);
  font-weight: 700;
  padding: 2px 7px;
  border-radius: 999px;
  background: rgba(255,255,255,.05);
  border: 1px solid var(--border);
}
.wait {
  font-size: 11px;
  color: var(--muted);
  font-weight: 600;
  font-variant-numeric: tabular-nums;
}
.wait::before { content: '⏱ '; opacity: .7; }

.duel-actions {
  display: flex;
  gap: 6px;
  flex-shrink: 0;
  align-items: center;
}
.duel-actions .btn {
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.04);
  color: var(--muted-2);
  font-size: 12px;
  font-weight: 800;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: background .15s, transform .12s;
  white-space: nowrap;
  font-family: inherit;
}
.duel-actions .btn:active { transform: scale(.94); }
.duel-actions .btn.primary {
  background: rgba(244,216,138,.07);
  border-color: rgba(244,216,138,.25);
  color: var(--gold);
}
.duel-actions .btn.danger {
  background: rgba(248,113,113,.07);
  border-color: rgba(248,113,113,.25);
  color: var(--bad);
}
.duel-actions .btn.ghost { color: var(--muted); }

/* Skeleton loading */
.duel-item.skeleton {
  height: 64px;
  background: rgba(255,255,255,.03);
  border-color: var(--border);
  overflow: hidden;
  position: relative;
  cursor: default;
}
.duel-item.skeleton::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.04), transparent);
  animation: skeletonShine 1.4s linear infinite;
}
@keyframes skeletonShine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Empty state */
.empty-state {
  text-align: center;
  padding: 28px 16px;
  color: var(--muted);
  font-size: 13px;
  font-weight: 600;
  line-height: 1.5;
}
.empty-state-icon {
  font-size: 28px;
  display: block;
  margin-bottom: 8px;
  opacity: .5;
}

/* ═══════════════════════════════════════════════
   MY DUELS TABS
═══════════════════════════════════════════════ */
.myduels-tabs {
  display: flex;
  gap: 6px;
  margin: 12px 0;
}
.myduels-tabs button {
  flex: 1;
  padding: 9px 6px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: rgba(255,255,255,.03);
  color: var(--muted);
  font-size: 12px;
  font-weight: 800;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: all .18s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  font-family: inherit;
}
.myduels-tabs button.is-active {
  color: var(--text);
  border-color: rgba(45,212,191,.3);
  background: rgba(45,212,191,.08);
}
.cnt {
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  border-radius: 999px;
  background: rgba(255,255,255,.08);
  font-size: 10px;
  font-weight: 900;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.myduels-tabs button.is-active .cnt { background: rgba(45,212,191,.2); }

.myduels-pane { display: none; }
.myduels-pane.is-active { display: block; }

/* ═══════════════════════════════════════════════
   HISTORY ROWS
═══════════════════════════════════════════════ */
.history-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.history-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px 14px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: var(--card);
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: border-color .15s, background .15s;
}
.history-item:active { background: var(--card-2); }

.history-left { display: flex; align-items: center; gap: 10px; min-width: 0; flex: 1; }
.history-avatars { display: flex; flex-shrink: 0; }
.history-avatars img {
  width: 32px; height: 32px;
  border-radius: 8px;
  object-fit: cover;
  background: var(--card-2);
  border: 1px solid var(--border-2);
}
.history-avatars img + img { margin-left: -8px; }

.history-info { min-width: 0; flex: 1; }
.history-title {
  font-size: 13px;
  font-weight: 700;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.history-right {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.pill {
  display: inline-flex;
  align-items: center;
  padding: 3px 9px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 800;
  border: 1px solid var(--border);
  color: var(--muted);
}
.pill.win { color: var(--good); border-color: rgba(52,211,153,.3); background: rgba(52,211,153,.06); }
.pill.lose { color: var(--bad); border-color: rgba(248,113,113,.3); background: rgba(248,113,113,.06); }
.pill.cancel { color: var(--muted); background: rgba(255,255,255,.04); }
.pill-id { color: var(--muted); background: rgba(255,255,255,.04); font-size: 11px; }

/* Mini header inside lists */
.mini-hdr {
  padding: 4px 2px;
  font-size: 11px;
  color: var(--muted);
  letter-spacing: .08em;
  text-transform: uppercase;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 6px;
}
.mini-hdr strong { color: var(--muted-2); font-size: 12px; text-transform: none; letter-spacing: 0; }
.mini-hdr .note { opacity: .75; font-size: 10px; text-transform: none; letter-spacing: 0; }

/* ═══════════════════════════════════════════════
   LOTTERY HUB
═══════════════════════════════════════════════ */
.lot-hero {
  border-radius: var(--radius);
  border: 1px solid rgba(45,212,191,.15);
  background: linear-gradient(135deg, rgba(18,36,56,.8), rgba(11,22,33,.6));
  padding: 16px;
  margin-bottom: 10px;
}
.lot-hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  border-radius: 999px;
  background: rgba(45,212,191,.1);
  border: 1px solid rgba(45,212,191,.3);
  color: rgba(167,243,208,1);
  font-size: 11px;
  font-weight: 900;
  letter-spacing: .06em;
  text-transform: uppercase;
  margin-bottom: 10px;
}
.lot-hero-title { font-size: 20px; font-weight: 900; margin-bottom: 6px; }
.lot-hero-sub { font-size: 13px; color: var(--muted-2); line-height: 1.45; margin-bottom: 12px; }
.lot-progress-bar {
  height: 8px;
  border-radius: 999px;
  background: rgba(255,255,255,.07);
  overflow: hidden;
  border: 1px solid rgba(255,255,255,.06);
  margin-bottom: 6px;
}
.lot-progress-fill {
  height: 100%;
  width: 34%;
  background: linear-gradient(90deg, rgba(34,211,238,.9), rgba(52,211,153,.9));
  border-radius: 999px;
}
.lot-meta { font-size: 12px; color: var(--muted); display: flex; gap: 12px; flex-wrap: wrap; }
.lot-meta b { color: var(--muted-2); }

.lot-btn {
  width: 100%;
  margin-top: 14px;
  padding: 13px;
  border-radius: var(--radius-sm);
  border: 1px solid rgba(244,216,138,.25);
  background: rgba(244,216,138,.07);
  color: rgba(244,216,138,.4);
  font-size: 14px;
  font-weight: 800;
  cursor: not-allowed;
  font-family: inherit;
}

.lot-tabs {
  display: flex;
  gap: 6px;
  margin-bottom: 10px;
}
.lot-tabs button {
  flex: 1;
  padding: 9px 6px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: rgba(255,255,255,.03);
  color: var(--muted);
  font-size: 12px;
  font-weight: 800;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: all .18s;
  font-family: inherit;
}
.lot-tabs button.is-active {
  color: var(--text);
  border-color: rgba(45,212,191,.3);
  background: rgba(45,212,191,.08);
}
.lot-pane { display: none; }
.lot-pane.is-active { display: block; }

.lot-empty-box {
  padding: 20px 16px;
  border-radius: var(--radius);
  border: 1px dashed rgba(255,255,255,.10);
  background: rgba(255,255,255,.02);
  text-align: center;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.5;
}
.lot-empty-box .title { font-weight: 800; color: var(--muted-2); margin-bottom: 6px; font-size: 14px; }

.lot-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 10px;
}
.lot-chip {
  padding: 14px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: var(--card);
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.lot-chip-label { font-size: 10px; color: var(--muted); font-weight: 800; text-transform: uppercase; letter-spacing: .06em; }
.lot-chip-title { font-size: 14px; font-weight: 800; }
.lot-chip-sub { font-size: 11px; color: var(--muted); }
.lot-chip-btn {
  margin-top: 10px;
  padding: 8px;
  border-radius: var(--radius-xs);
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.04);
  color: rgba(255,255,255,.25);
  font-size: 11px;
  font-weight: 800;
  cursor: not-allowed;
  font-family: inherit;
}

/* PF info card */
.info-card {
  padding: 14px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: var(--card);
  margin-top: 10px;
}
.info-card h3 { font-size: 14px; font-weight: 800; margin-bottom: 6px; }
.info-card p { font-size: 13px; color: var(--muted-2); line-height: 1.5; }

/* ═══════════════════════════════════════════════
   STAT STRIP — вверху раздела Ставки
═══════════════════════════════════════════════ */
.stat-strip {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 14px;
}
.stat-chip {
  padding: 10px 8px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--card);
  text-align: center;
}
.stat-chip .v {
  font-size: 16px;
  font-weight: 900;
  font-variant-numeric: tabular-nums;
  line-height: 1;
}
.stat-chip .t {
  font-size: 10px;
  color: var(--muted);
  font-weight: 700;
  margin-top: 3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ═══════════════════════════════════════════════
   MODAL — bottom sheet on mobile
═══════════════════════════════════════════════ */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  z-index: 200;
  display: none;
  align-items: flex-end; /* bottom sheet */
  justify-content: center;
  padding: 12px;
  padding-bottom: calc(12px + var(--safe-bottom));
}
.modal-backdrop.show { display: flex; }

.modal {
  width: 100%;
  max-width: 560px;
  border-radius: 20px 20px 16px 16px;
  border: 1px solid var(--border-2);
  background: #0e1320;
  box-shadow: 0 -20px 60px rgba(0,0,0,.5);
  overflow: hidden;
  animation: slideUp .28s cubic-bezier(.34,1.4,.64,1);
}
@keyframes slideUp {
  from { transform: translateY(40px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Drag handle */
.modal::before {
  content: '';
  display: block;
  width: 36px;
  height: 4px;
  border-radius: 2px;
  background: rgba(255,255,255,.15);
  margin: 10px auto 0;
}

.modal-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px 12px;
  border-bottom: 1px solid var(--border);
}
.modal-title { font-size: 16px; font-weight: 800; }
.modal-close {
  width: 32px; height: 32px;
  border-radius: 50%;
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.06);
  color: var(--muted-2);
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-tap-highlight-color: transparent;
  font-family: inherit;
}
.modal-body { padding: 14px 16px; }

.kv {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 8px 14px;
  font-size: 14px;
}
.kv .k { color: var(--muted); font-weight: 600; white-space: nowrap; }
.kv .v { font-weight: 700; overflow-wrap: anywhere; }

.modal-foot {
  padding: 10px 16px;
  border-top: 1px solid var(--border);
}

/* Seg tabs in modal */
.seg {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin: 8px 0 14px;
}
.seg button {
  padding: 8px 14px;
  border-radius: 999px;
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.04);
  color: var(--muted);
  font-size: 13px;
  font-weight: 800;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: all .15s;
  font-family: inherit;
}
.seg button.is-active {
  color: var(--text);
  border-color: var(--gold-border);
  background: rgba(244,216,138,.08);
}
.mode-pane { display: none; }
.mode-pane.is-active { display: block; }

.field { display: flex; flex-direction: column; gap: 6px; margin-top: 12px; }
.field label { font-size: 12px; color: var(--muted); font-weight: 700; }
.field input, .field select {
  padding: 11px 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-2);
  background: rgba(0,0,0,.3);
  color: var(--text);
  font-size: 15px;
  font-family: inherit;
  outline: none;
  -webkit-appearance: none;
}
.field input:focus, .field select:focus { border-color: rgba(244,216,138,.4); }

.badge-soon {
  display: inline-flex;
  align-items: center;
  padding: 2px 7px;
  border-radius: 999px;
  border: 1px solid rgba(248,113,113,.3);
  background: rgba(248,113,113,.07);
  color: #fca5a5;
  font-size: 10px;
  font-weight: 900;
  margin-left: 5px;
}

.modal-foot-actions {
  display: flex;
  gap: 8px;
}
.modal-foot-actions .btn {
  flex: 1;
  padding: 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-2);
  background: rgba(255,255,255,.04);
  color: var(--muted-2);
  font-size: 14px;
  font-weight: 800;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  font-family: inherit;
  transition: background .15s, transform .12s;
  text-align: center;
}
.modal-foot-actions .btn:active { transform: scale(.97); }
.modal-foot-actions .btn.primary {
  background: rgba(244,216,138,.08);
  border-color: var(--gold-border);
  color: var(--gold);
}

/* ═══════════════════════════════════════════════
   COIN OVERLAY
═══════════════════════════════════════════════ */
.coin-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 300;
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 20px;
}
.coin-overlay.show { display: flex; }
.coin-label {
  font-size: 18px;
  font-weight: 800;
  text-align: center;
  padding: 0 24px;
}
.coin {
  width: 80px; height: 80px;
  border-radius: 50%;
  border: 2px solid rgba(255,215,0,.5);
  background: radial-gradient(circle at 32% 30%, rgba(255,215,0,.9), rgba(180,130,0,.6));
  box-shadow: 0 0 30px rgba(255,200,0,.2), inset 0 0 20px rgba(255,255,255,.15);
  animation: coinFlip 1s linear infinite;
}
@keyframes coinFlip {
  0% { transform: rotateY(0deg) scale(1); }
  25% { transform: rotateY(90deg) scale(.9); }
  50% { transform: rotateY(180deg) scale(1); }
  75% { transform: rotateY(270deg) scale(.9); }
  100% { transform: rotateY(360deg) scale(1); }
}
.coin-sub { font-size: 14px; color: var(--muted-2); text-align: center; }

/* ═══════════════════════════════════════════════
   TOAST
═══════════════════════════════════════════════ */
.toast {
  position: fixed;
  left: 50%;
  bottom: calc(var(--tab-h) + var(--safe-bottom) + 12px);
  transform: translateX(-50%);
  background: #1a2035;
  border: 1px solid rgba(255,255,255,.12);
  border-radius: var(--radius-sm);
  padding: 10px 16px;
  max-width: min(400px, calc(100vw - 28px));
  width: max-content;
  box-shadow: 0 8px 30px rgba(0,0,0,.4);
  z-index: 250;
  display: none;
  animation: toastIn .22s ease;
  pointer-events: none;
}
.toast.show { display: block; }
@keyframes toastIn {
  from { opacity: 0; transform: translateX(-50%) translateY(8px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}
.toast .t { font-weight: 800; font-size: 13px; }
.toast .b { color: var(--muted-2); font-size: 12px; margin-top: 2px; }

/* ═══════════════════════════════════════════════
   DESKTOP ADJUSTMENTS (≥640px)
═══════════════════════════════════════════════ */
@media (min-width: 640px) {
  .hdr-name { display: block; }

  .stakes-scroll {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    overflow-x: visible;
    margin: 0;
    padding: 0;
  }
  .stake-card { width: auto; }

  .modal-backdrop { align-items: center; }
  .modal { border-radius: 20px; max-width: 480px; }
  .modal::before { display: none; }

  .stat-strip { grid-template-columns: repeat(4, 1fr); }
}

@media (min-width: 900px) {
  :root { --hdr-h: 62px; --tab-h: 0px; }

  body { padding-bottom: 0; }

  /* Show desktop sidebar instead of bottom tab bar */
  .tab-bar { display: none; }

  /* Desktop layout: sidebar + main */
  .page-layout {
    display: grid;
    grid-template-columns: 220px 1fr;
    gap: 16px;
    max-width: 1100px;
    margin: 0 auto;
    padding: 16px 20px;
    align-items: start;
  }
  .wrap { padding: 0; max-width: none; }

  .desktop-sidebar {
    display: block;
    position: sticky;
    top: calc(var(--hdr-h) + 12px);
  }
  .sidebar-card {
    padding: 14px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--card);
    margin-bottom: 10px;
  }
  .sidebar-title { font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: .1em; color: var(--muted); margin-bottom: 10px; }
  .sidebar-nav { display: flex; flex-direction: column; gap: 4px; }
  .sidebar-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 9px 12px;
    border-radius: var(--radius-sm);
    border: 1px solid transparent;
    color: var(--muted-2);
    text-decoration: none;
    font-size: 13px;
    font-weight: 700;
    transition: all .15s;
  }
  .sidebar-link:hover { background: rgba(255,255,255,.04); color: var(--text); }
  .sidebar-link.is-active { background: rgba(45,212,191,.08); border-color: rgba(45,212,191,.2); color: var(--accent); }
  .sidebar-link .badge { font-size: 11px; color: var(--muted); font-weight: 700; }

  .stakes-scroll {
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 899px) {
  .desktop-sidebar { display: none; }
  .page-layout { display: block; padding: 0; }
}

/* ═══════════════════════════════════════════════
   ACCESSIBILITY
═══════════════════════════════════════════════ */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: .01ms !important;
    transition-duration: .01ms !important;
  }
}

button:focus-visible, a:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}
</style>
</head>
<body>

<!-- ══════════════════════════════════
     HEADER
══════════════════════════════════ -->
<header class="hdr">
  <a class="hdr-brand" href="/index.html" aria-label="GG Room — на главную">
    <span class="gg">GG</span><span class="room">ROOM</span>
  </a>

  <div class="hdr-right">
    <!-- balance chip — клик открывает топап -->
    <div class="hdr-balance" id="user-balance" role="button" tabindex="0" aria-label="Баланс">
      <span class="hdr-balance-icon">₽</span>
      <span class="hdr-balance-amount"><span class="balance-amount" data-balance="">0</span></span>
      <span class="hdr-balance-label">баланс</span>
    </div>

    <button class="btn-topup" id="topup-btn" aria-label="Пополнить баланс">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" aria-hidden="true">
        <path d="M12 5v14M5 12h14"/>
      </svg>
      <span>Пополнить</span>
    </button>

    <!-- link buttons (hidden, shown by JS) -->
    <button class="btn-topup" id="link-tg" style="display:none" type="button">Telegram</button>
    <button class="btn-topup" id="link-vk" style="display:none" type="button">ВКонтакте</button>

    <img class="hdr-avatar" alt="Аватар" id="user-avatar"
      src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Crect width='80' height='80' rx='40' fill='%23222'/%3E%3Ctext x='40' y='48' text-anchor='middle' font-size='28' fill='%23aaa' font-family='Arial'%3EGG%3C/text%3E%3C/svg%3E"
      referrerpolicy="no-referrer"/>
    <span class="hdr-name" id="user-name-text">Гость</span>
  </div>
</header>

<!-- ══════════════════════════════════
     PAGE LAYOUT
══════════════════════════════════ -->
<div class="page-layout">

  <!-- Desktop sidebar -->
  <aside class="desktop-sidebar" aria-label="Навигация">
    <div class="sidebar-card">
      <div class="sidebar-title">Дуэли</div>
      <nav class="sidebar-nav">
        <a class="sidebar-link is-active" href="#stakes" data-nav="stakes">
          Ставки <span class="badge">создать</span>
        </a>
        <a class="sidebar-link" href="#live" data-nav="live">
          Live <span class="badge" id="sb-live-cnt">—</span>
        </a>
        <a class="sidebar-link" href="#archive" data-nav="archive">
          Мои дуэли <span class="badge" id="sb-archive-cnt">—</span>
        </a>
      </nav>
    </div>
    <div class="sidebar-card">
      <div class="sidebar-title">Разделы</div>
      <nav class="sidebar-nav">
        <a class="sidebar-link" href="#lottery" data-nav="lottery">
          Розыгрыши <span class="badge">скоро</span>
        </a>
      </nav>
    </div>
    <div class="sidebar-card">
      <div class="sidebar-title">Provably Fair</div>
      <p style="font-size:12px;color:var(--muted-2);line-height:1.5">
        Каждая дуэль: commit → reveal → winner. Seed/nonce/commit видны в карточке.
      </p>
    </div>
    <div class="sidebar-card" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div class="stat-chip"><div class="v" id="kpi-open">—</div><div class="t">Открытых</div></div>
      <div class="stat-chip"><div class="v" id="kpi-myopen">—</div><div class="t">Моих open</div></div>
      <div class="stat-chip"><div class="v" id="kpi-history">—</div><div class="t">Архив</div></div>
      <div class="stat-chip"><div class="v" id="kpi-links">—</div><div class="t">Связи</div></div>
    </div>
  </aside>

  <!-- Main scroll -->
  <main class="wrap" aria-label="Основной контент">

    <!-- ── HUB: STAKES ───────────────────────────── -->
    <section class="hub is-active" id="hub-stakes" aria-label="Ставки">

      <div class="welcome" id="welcome-card">
        <div class="welcome-text">Добро пожаловать в лобби</div>
        <p id="provider-note" class="welcome-sub"></p>
      </div>

      <!-- Stats strip (mobile only) -->
      <div class="stat-strip" aria-label="Статистика" id="mobile-stats">
        <div class="stat-chip"><div class="v" id="m-kpi-open">—</div><div class="t">Открытых</div></div>
        <div class="stat-chip"><div class="v" id="m-kpi-myopen">—</div><div class="t">Моих</div></div>
        <div class="stat-chip"><div class="v" id="m-kpi-history">—</div><div class="t">Архив</div></div>
        <div class="stat-chip"><div class="v" id="m-kpi-links">—</div><div class="t">Связи</div></div>
      </div>

      <div class="section-hd">
        <span class="section-title">Дуэли 1v1</span>
        <div style="display:flex;gap:6px;align-items:center">
          <span class="mode-pill" id="create-mode-pill"><span class="tag">1v1</span> Публичная</span>
          <button class="mode-link" id="create-mode-btn" aria-label="Настройки режима" type="button">⚙</button>
        </div>
      </div>

      <div class="muted" style="font-size:12px;margin-bottom:10px;padding:0 2px">
        Выбери ставку → создай комнату → дождись соперника. Coinflip определяет победителя.
      </div>

      <!-- Stake cards — horizontal scroll on mobile -->
      <div class="stakes-scroll" aria-label="Ставки" role="list">

        <div class="stake-card is-selected" data-stake="100" role="listitem">
          <div class="stake-badge" aria-hidden="true"></div>
          <div class="stake-amt">₽100</div>
          <div class="stake-meta">pot ₽200 · fee ~₽10</div>
          <div class="stake-live"><span class="stake-live-dot"></span><span>Открытых: <b data-open-count="100">—</b></span></div>
          <div class="stake-actions">
            <button class="btn primary" data-action="quick" data-stake="100" type="button">Быстрый</button>
            <button class="btn" data-action="create" data-stake="100" type="button">Создать</button>
          </div>
        </div>

        <div class="stake-card" data-stake="250" role="listitem">
          <div class="stake-badge" aria-hidden="true"></div>
          <div class="stake-amt">₽250</div>
          <div class="stake-meta">pot ₽500 · fee ~₽25</div>
          <div class="stake-live"><span class="stake-live-dot"></span><span>Открытых: <b data-open-count="250">—</b></span></div>
          <div class="stake-actions">
            <button class="btn primary" data-action="quick" data-stake="250" type="button">Быстрый</button>
            <button class="btn" data-action="create" data-stake="250" type="button">Создать</button>
          </div>
        </div>

        <div class="stake-card" data-stake="500" role="listitem">
          <div class="stake-badge" aria-hidden="true"></div>
          <div class="stake-amt">₽500</div>
          <div class="stake-meta">pot ₽1 000 · fee ~₽50</div>
          <div class="stake-live"><span class="stake-live-dot"></span><span>Открытых: <b data-open-count="500">—</b></span></div>
          <div class="stake-actions">
            <button class="btn primary" data-action="quick" data-stake="500" type="button">Быстрый</button>
            <button class="btn" data-action="create" data-stake="500" type="button">Создать</button>
          </div>
        </div>

        <div class="stake-card" data-stake="1000" role="listitem">
          <div class="stake-badge" aria-hidden="true"></div>
          <div class="stake-amt">₽1 000</div>
          <div class="stake-meta">pot ₽2 000 · fee ~₽100</div>
          <div class="stake-live"><span class="stake-live-dot"></span><span>Открытых: <b data-open-count="1000">—</b></span></div>
          <div class="stake-actions">
            <button class="btn primary" data-action="quick" data-stake="1000" type="button">Быстрый</button>
            <button class="btn" data-action="create" data-stake="1000" type="button">Создать</button>
          </div>
        </div>

        <div class="stake-card" data-stake="2500" role="listitem">
          <div class="stake-badge" aria-hidden="true"></div>
          <div class="stake-amt">₽2 500</div>
          <div class="stake-meta">pot ₽5 000 · fee ~₽250</div>
          <div class="stake-live"><span class="stake-live-dot"></span><span>Открытых: <b data-open-count="2500">—</b></span></div>
          <div class="stake-actions">
            <button class="btn primary" data-action="quick" data-stake="2500" type="button">Быстрый</button>
            <button class="btn" data-action="create" data-stake="2500" type="button">Создать</button>
          </div>
        </div>

        <div class="stake-card stake-vip" data-disabled="1" data-stake="vip" role="listitem" aria-label="VIP — скоро">
          <div class="stake-badge badge-vip has-badge" aria-hidden="true">VIP</div>
          <div class="stake-amt">VIP</div>
          <div class="stake-meta">Особые условия · приватные дуэли · скоро</div>
          <div class="stake-live"><span class="stake-live-dot"></span><span>Открытых: <b data-open-count="vip">—</b></span></div>
          <div class="stake-actions">
            <button class="btn primary" disabled type="button">Скоро</button>
            <button class="btn" disabled type="button">Создать</button>
          </div>
        </div>

      </div><!-- /stakes-scroll -->

      <div class="mode-row">
        <span class="muted" style="font-size:12px">Режим:</span>
        <button class="mode-link" id="create-mode-link" type="button">изменить</button>
      </div>

    </section>

    <!-- ── HUB: LIVE ─────────────────────────────── -->
    <section class="hub" id="hub-live" aria-label="Активные дуэли">
      <div class="section-hd" id="live">
        <span class="section-title">Live — открытые комнаты</span>
        <button class="btn-refresh" id="duels-refresh" type="button" aria-label="Обновить список">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" aria-hidden="true"><path d="M1 4v6h6M23 20v-6h-6"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10M23 14l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>
          Обновить
        </button>
      </div>
      <div class="duels-list" id="duels-list">
        <div class="muted" style="font-size:13px;padding:8px 2px">Загружаю комнаты…</div>
      </div>
    </section>

    <!-- ── HUB: ARCHIVE / MY DUELS ───────────────── -->
    <section class="hub" id="hub-archive" aria-label="Мои дуэли">
      <div class="section-hd" id="archive">
        <span class="section-title">Мои дуэли</span>
      </div>

      <div class="myduels-tabs" role="tablist" aria-label="Мои дуэли">
        <button class="is-active" data-myduels-tab="active" type="button" role="tab" aria-selected="true">
          Активные <span class="cnt" id="myduels-count-active">0</span>
        </button>
        <button data-myduels-tab="created" type="button" role="tab" aria-selected="false">
          Созданные <span class="cnt" id="myduels-count-created">0</span>
        </button>
        <button data-myduels-tab="archive" type="button" role="tab" aria-selected="false">
          Архив <span class="cnt" id="myduels-count-archive">0</span>
        </button>
      </div>

      <div class="myduels-pane is-active" id="myduels-pane-active">
        <div class="duels-list" id="myduels-active-list">
          <div class="muted" style="font-size:13px;padding:8px 2px">Загружаю…</div>
        </div>
      </div>
      <div class="myduels-pane" id="myduels-pane-created">
        <div id="myduels-created-list">
          <div class="muted" style="font-size:13px;padding:8px 2px">Загружаю…</div>
        </div>
      </div>
      <div class="myduels-pane" id="myduels-pane-archive">
        <div class="history-list" id="history-list">
          <div class="muted" style="font-size:13px;padding:8px 2px">Загружаю историю…</div>
        </div>
      </div>
    </section>

    <!-- ── HUB: LOTTERY ──────────────────────────── -->
    <section class="hub" id="hub-lottery" aria-label="Розыгрыши">
      <div class="section-hd" id="lottery">
        <span class="section-title">Розыгрыши</span>
        <span class="pill">Скоро</span>
      </div>

      <div class="lot-hero">
        <div class="lot-hero-badge">● РОЗЫГРЫШ НЕДЕЛИ</div>
        <div class="lot-hero-title">iPhone 17 Pro</div>
        <div class="lot-hero-sub">Билеты от ₽100 · механика билетов подключится позже — сейчас UI</div>
        <div class="lot-progress-bar"><div class="lot-progress-fill"></div></div>
        <div class="lot-meta">
          <span>Продано: <b>340 / 1000</b></span>
          <span>Банк: <b>₽34 000</b></span>
          <span>Финиш: <b>скоро</b></span>
        </div>
        <button class="lot-btn" disabled type="button">Купить билет (soon)</button>
      </div>

      <div class="lot-tabs" role="tablist">
        <button class="is-active" data-lot-tab="active" type="button">Активные</button>
        <button data-lot-tab="archive" type="button">Архив</button>
        <button data-lot-tab="mine" type="button">Мои билеты</button>
      </div>

      <div class="lot-pane is-active" data-lot-pane="active">
        <div class="lot-grid">
          <div class="lot-chip">
            <div class="lot-chip-label">Розыгрыш</div>
            <div class="lot-chip-title">iPhone 17 Pro</div>
            <div class="lot-chip-sub">Билеты · таймер</div>
            <button class="lot-chip-btn" disabled type="button">Скоро</button>
          </div>
          <div class="lot-chip">
            <div class="lot-chip-label">Розыгрыш</div>
            <div class="lot-chip-title">Largus</div>
            <div class="lot-chip-sub">Билеты · таймер</div>
            <button class="lot-chip-btn" disabled type="button">Скоро</button>
          </div>
          <div class="lot-chip">
            <div class="lot-chip-label">Розыгрыш</div>
            <div class="lot-chip-title">Денежный приз</div>
            <div class="lot-chip-sub">Билеты · таймер</div>
            <button class="lot-chip-btn" disabled type="button">Скоро</button>
          </div>
        </div>
      </div>

      <div class="lot-pane" data-lot-pane="archive">
        <div class="lot-empty-box">
          <div class="title">Архив розыгрышей</div>
          Пока пуст. UI готов — данные появятся после подключения механики.
        </div>
      </div>

      <div class="lot-pane" data-lot-pane="mine">
        <div class="lot-empty-box">
          <div class="title">Мои билеты</div>
          История билетов: куплено, статус, выигрыш — скоро.
        </div>
      </div>

      <div class="info-card">
        <h3>Честность розыгрышей</h3>
        <p>Прозрачные правила, публичные результаты и проверяемый механизм выбора победителя (аналог provably fair).</p>
      </div>
    </section>

  </main>
</div><!-- /page-layout -->

<!-- ══════════════════════════════════
     BOTTOM TAB BAR
══════════════════════════════════ -->
<nav class="tab-bar" aria-label="Навигация">

  <button class="tab-item is-active" data-tab="stakes" type="button" aria-label="Ставки">
    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" aria-hidden="true">
      <rect x="3" y="3" width="18" height="18" rx="3"/>
      <path d="M3 9h18M9 21V9"/>
    </svg>
    <span class="tab-label">Ставки</span>
  </button>

  <button class="tab-item" data-tab="live" type="button" aria-label="Live дуэли">
    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" aria-hidden="true">
      <circle cx="12" cy="12" r="3"/>
      <path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"/>
      <path d="M15.54 8.46a5 5 0 0 1 0 7.07M8.46 8.46a5 5 0 0 0 0 7.07"/>
    </svg>
    <span class="tab-label">Live</span>
    <span class="tab-badge" id="tab-live-badge"></span>
  </button>

  <button class="tab-item" data-tab="archive" type="button" aria-label="Мои дуэли">
    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" aria-hidden="true">
      <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
    </svg>
    <span class="tab-label">Мои</span>
    <span class="tab-badge" id="tab-archive-badge"></span>
  </button>

  <button class="tab-item" data-tab="lottery" type="button" aria-label="Розыгрыши">
    <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" aria-hidden="true">
      <path d="M20 12V22H4V12"/><path d="M22 7H2v5h20V7z"/>
      <path d="M12 22V7"/>
      <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/>
      <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
    </svg>
    <span class="tab-label">Призы</span>
  </button>

</nav>

<!-- ══════════════════════════════════
     MODALS
══════════════════════════════════ -->

<!-- Duel details modal -->
<div class="modal-backdrop" id="duel-modal" role="dialog" aria-modal="true" aria-label="Детали дуэли">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="duel-modal-title">Дуэль</div>
      <button class="modal-close" id="duel-modal-close" aria-label="Закрыть">✕</button>
    </div>
    <div class="modal-body">
      <div class="kv" id="duel-modal-kv"></div>
    </div>
  </div>
</div>

<!-- Create mode modal -->
<div class="modal-backdrop" id="create-modal" role="dialog" aria-modal="true" aria-label="Создать комнату">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">Создать комнату</div>
      <button class="modal-close" id="create-modal-close" type="button" aria-label="Закрыть">✕</button>
    </div>
    <div class="modal-body">
      <div class="muted" style="font-size:13px;line-height:1.4;margin-bottom:4px">
        Сейчас работает только <b>публичная дуэль 1v1</b> — остальные режимы на подходе.
      </div>
      <div class="seg" role="tablist" aria-label="Режим комнаты">
        <button class="is-active" data-mode="duel_1v1_public" type="button">1v1</button>
        <button data-mode="duel_invite" type="button">Invite <span class="badge-soon">soon</span></button>
        <button data-mode="duel_multi" type="button">3/6/10 <span class="badge-soon">soon</span></button>
      </div>

      <div class="mode-pane is-active" data-pane="duel_1v1_public">
        <div style="font-weight:800;font-size:14px">Публичная дуэль 1v1</div>
        <div class="muted" style="font-size:13px;margin-top:6px;line-height:1.4">
          Комната попадёт в Live. Победитель — coinflip. Детали в карточке дуэли.
        </div>
      </div>

      <div class="mode-pane" data-pane="duel_invite">
        <div style="font-weight:800;font-size:14px">Приглашение игрока</div>
        <div class="muted" style="font-size:13px;margin-top:6px;line-height:1.4">
          Приватная комната — видна только вам двоим.
        </div>
        <div class="field">
          <label for="invite-user-id">Кого приглашаем (user_id)</label>
          <input id="invite-user-id" min="1" placeholder="например: 97" type="number"/>
        </div>
      </div>

      <div class="mode-pane" data-pane="duel_multi">
        <div style="font-weight:800;font-size:14px">Комнаты на несколько участников</div>
        <div class="muted" style="font-size:13px;margin-top:6px;line-height:1.4">
          3 / 6 / 10 человек — механика будет похожа.
        </div>
        <div class="field">
          <label for="multi-size">Количество участников</label>
          <select id="multi-size">
            <option value="3">3</option>
            <option value="6">6</option>
            <option value="10">10</option>
          </select>
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <div class="modal-foot-actions">
        <button class="btn" id="create-modal-cancel" type="button">Отмена</button>
        <button class="btn primary" id="create-modal-save" type="button">Сохранить</button>
        <button class="btn primary" id="create-modal-create" type="button">Создать</button>
      </div>
    </div>
  </div>
</div>

<!-- Coin flip overlay -->
<div class="coin-overlay" id="coin-overlay" role="status" aria-live="polite">
  <div class="coin-label">Монетка решает судьбу…</div>
  <div class="coin" aria-hidden="true"></div>
  <div class="coin-sub">Честный coinflip. Секунду.</div>
</div>

<!-- Toast -->
<div class="toast" id="toast" role="alert" aria-live="assertive">
  <div class="t" id="toast-title"></div>
  <div class="b" id="toast-body"></div>
</div>

<!-- ══════════════════════════════════
     SCRIPTS
══════════════════════════════════ -->
<script async src="https://telegram.org/js/telegram-widget.js?22"></script>
<script src="/js/lobby-balance-fix.js"></script>
<script src="/js/duels-lobby.js?v=12"></script>

<script>
(function () {

  /* ── Tab navigation ─────────────────────────── */
  const tabs = Array.from(document.querySelectorAll('.tab-item[data-tab]'));
  const hubs = {
    stakes:  document.getElementById('hub-stakes'),
    live:    document.getElementById('hub-live'),
    archive: document.getElementById('hub-archive'),
    lottery: document.getElementById('hub-lottery'),
  };

  const sidebarLinks = Array.from(document.querySelectorAll('.sidebar-link[data-nav]'));

  // Hash → tab mapping
  const hashToTab = {
    '#stakes':  'stakes',
    '#live':    'live',
    '#archive': 'archive',
    '#lottery': 'lottery',
    '#':        'stakes',
    '':         'stakes',
  };

  let currentTab = 'stakes';

  function activateTab(tab) {
    if (!hubs[tab]) tab = 'stakes';
    currentTab = tab;

    // hubs
    Object.entries(hubs).forEach(([k, el]) => {
      if (el) el.classList.toggle('is-active', k === tab);
    });

    // bottom tabs
    tabs.forEach(t => t.classList.toggle('is-active', t.dataset.tab === tab));

    // sidebar links
    sidebarLinks.forEach(a => a.classList.toggle('is-active', a.dataset.nav === tab));

    // sync hash without scroll jump
    const newHash = '#' + tab;
    if (location.hash !== newHash) {
      history.replaceState(null, '', newHash);
    }

    // lottery sub-tabs
    const isLottery = tab === 'lottery';
    const lotSub = document.getElementById('lottery-subnav');
    if (lotSub) lotSub.style.display = isLottery ? '' : 'none';

    // fire event for duels-lobby.js polling sync
    window.dispatchEvent(new HashChangeEvent('hashchange'));
  }

  // Clicks on bottom tabs
  tabs.forEach(t => {
    t.addEventListener('click', () => activateTab(t.dataset.tab));
  });

  // Clicks on sidebar links
  sidebarLinks.forEach(a => {
    a.addEventListener('click', e => {
      e.preventDefault();
      activateTab(a.dataset.nav);
    });
  });

  // Anchor links within page (stake cards etc.) → resolve to tab
  document.addEventListener('click', e => {
    const a = e.target.closest('a[href^="#"]');
    if (!a) return;
    const hash = a.getAttribute('href');
    const tab = hashToTab[hash];
    if (tab) {
      e.preventDefault();
      activateTab(tab);
    }
  });

  // Initial state from hash
  const initTab = hashToTab[location.hash] || 'stakes';
  activateTab(initTab);

  // Sync KPIs to mobile stat strip
  function syncMobileKpis() {
    const map = { open:'m-kpi-open', myopen:'m-kpi-myopen', history:'m-kpi-history', links:'m-kpi-links' };
    Object.entries(map).forEach(([k, mId]) => {
      const src = document.getElementById('kpi-' + k);
      const dst = document.getElementById(mId);
      if (src && dst) {
        const observer = new MutationObserver(() => { dst.textContent = src.textContent; });
        observer.observe(src, { childList: true, characterData: true, subtree: true });
        dst.textContent = src.textContent;
      }
    });
  }
  syncMobileKpis();

  // Live tab badge: update when kpi-open changes
  const kpiOpen = document.getElementById('kpi-open');
  const liveBadge = document.getElementById('tab-live-badge');
  if (kpiOpen && liveBadge) {
    new MutationObserver(() => {
      const n = parseInt(kpiOpen.textContent, 10);
      if (n > 0) { liveBadge.textContent = n; liveBadge.classList.add('visible'); }
      else liveBadge.classList.remove('visible');
    }).observe(kpiOpen, { childList: true, characterData: true, subtree: true });
  }

  // Balance chip also triggers topup
  const balChip = document.getElementById('user-balance');
  const topupBtn = document.getElementById('topup-btn');
  if (balChip && topupBtn) {
    balChip.addEventListener('click', () => topupBtn.click());
    balChip.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') topupBtn.click(); });
  }

  /* ── Modals ─────────────────────────────────── */
  function openModal(id) {
    const m = document.getElementById(id);
    if (m) { m.classList.add('show'); m.style.display = 'flex'; }
  }
  function closeModal(id) {
    const m = document.getElementById(id);
    if (m) { m.classList.remove('show'); m.style.display = ''; }
  }
  function closeAllModals() {
    document.querySelectorAll('.modal-backdrop').forEach(m => {
      m.classList.remove('show');
      m.style.display = '';
    });
  }

  document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
    backdrop.addEventListener('click', e => { if (e.target === backdrop) closeAllModals(); });
  });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeAllModals(); });

  document.getElementById('duel-modal-close')?.addEventListener('click', () => closeModal('duel-modal'));
  document.getElementById('create-modal-close')?.addEventListener('click', () => closeModal('create-modal'));

  // expose for duels-lobby.js
  window.__gg_openDuelModal  = () => openModal('duel-modal');
  window.__gg_closeDuelModal = () => closeModal('duel-modal');

  // Coin overlay
  const coinEl = document.getElementById('coin-overlay');
  window.__gg_showCoin = show => {
    if (!coinEl) return;
    if (show) { coinEl.classList.add('show'); coinEl.style.display = 'flex'; }
    else      { coinEl.classList.remove('show'); coinEl.style.display = ''; }
  };

  /* ── Create-mode modal ──────────────────────── */
  const LS_MODE = 'ggroom_create_mode_v1';

  function getMode() {
    try {
      const raw = localStorage.getItem(LS_MODE);
      if (raw) {
        const m = JSON.parse(raw);
        if (m && m.type === 'lottery') return { type: 'duel_1v1_public' };
        return m;
      }
    } catch (_) {}
    return { type: 'duel_1v1_public' };
  }
  function setMode(m) {
    try { localStorage.setItem(LS_MODE, JSON.stringify(m)); } catch (_) {}
    renderMode();
  }

  const segBtns = Array.from(document.querySelectorAll('#create-modal .seg button[data-mode]'));
  const modePanes = Array.from(document.querySelectorAll('.mode-pane[data-pane]'));

  function setActiveSeg(type) {
    segBtns.forEach(b => b.classList.toggle('is-active', b.dataset.mode === type));
    modePanes.forEach(p => p.classList.toggle('is-active', p.dataset.pane === type));
  }

  function renderMode() {
    const m = getMode();
    const map = {
      duel_1v1_public: { tag: '1v1', text: 'Публичная' },
      duel_invite:     { tag: 'INV', text: `Invite${m.invite_user_id ? ` #${m.invite_user_id}` : ''}` },
      duel_multi:      { tag: 'MLT', text: `×${m.seats || 3}` },
    };
    const x = map[m.type] || map.duel_1v1_public;
    const pill = document.getElementById('create-mode-pill');
    if (pill) pill.innerHTML = `<span class="tag">${x.tag}</span> ${x.text}`;
    setActiveSeg(m.type);

    const ok = m.type === 'duel_1v1_public';
    document.querySelectorAll('[data-action="quick"],[data-action="create"]').forEach(b => {
      b.disabled = !ok;
      if (b.dataset.action === 'quick') b.textContent = ok ? 'Быстрый' : 'Скоро';
      if (b.dataset.action === 'create') b.textContent = ok ? 'Создать' : 'Скоро';
    });
  }

  segBtns.forEach(b => b.addEventListener('click', () => setActiveSeg(b.dataset.mode)));

  function openCreateModal(e) { if (e) e.preventDefault(); setActiveSeg(getMode().type); openModal('create-modal'); }
  document.getElementById('create-mode-btn')?.addEventListener('click', openCreateModal);
  document.getElementById('create-mode-link')?.addEventListener('click', openCreateModal);

  function collectSeg() {
    const active = segBtns.find(b => b.classList.contains('is-active'));
    const type = active ? active.dataset.mode : 'duel_1v1_public';
    const m = { type };
    if (type === 'duel_invite') {
      const v = parseInt(document.getElementById('invite-user-id')?.value || '', 10);
      if (Number.isFinite(v) && v > 0) m.invite_user_id = v;
    }
    if (type === 'duel_multi') {
      const seats = parseInt(document.getElementById('multi-size')?.value || '3', 10);
      m.seats = Number.isFinite(seats) ? seats : 3;
    }
    return m;
  }

  function showToast(title, body) {
    const t = document.getElementById('toast');
    if (!t) return;
    document.getElementById('toast-title').textContent = title || '';
    document.getElementById('toast-body').textContent  = body  || '';
    t.classList.add('show');
    clearTimeout(window.__gg_toast_timer);
    window.__gg_toast_timer = setTimeout(() => t.classList.remove('show'), 2800);
  }
  window.showToast = showToast;

  document.getElementById('create-modal-cancel')?.addEventListener('click', () => closeModal('create-modal'));
  document.getElementById('create-modal-save')?.addEventListener('click', () => {
    const m = collectSeg();
    setMode(m);
    closeModal('create-modal');
    showToast('Режим сохранён', m.type !== 'duel_1v1_public' ? 'Этот режим пока в разработке.' : 'Публичная дуэль 1v1.');
  });
  document.getElementById('create-modal-create')?.addEventListener('click', () => {
    const m = collectSeg();
    setMode(m);
    closeModal('create-modal');
    if (m.type !== 'duel_1v1_public') {
      showToast('Скоро', 'Этот формат появится позже. Пока — публичная 1v1.');
      return;
    }
    if (typeof window.__gg_duels_create_selected === 'function') window.__gg_duels_create_selected();
    else showToast('Ок', 'Выбери ставку и нажми «Создать» на карточке.');
  });

  // Block unsupported modes
  document.addEventListener('click', e => {
    const btn = e.target?.closest('[data-action="create"],[data-action="quick"]');
    if (!btn) return;
    if (getMode().type !== 'duel_1v1_public') {
      e.preventDefault();
      e.stopImmediatePropagation();
      showToast('Скоро', 'Выбранный режим пока не активен.');
    }
  }, true);

  renderMode();

  /* ── Lottery tabs ───────────────────────────── */
  const LS_LOT = 'ggroom_lottery_tab_v1';
  const lotBtns  = Array.from(document.querySelectorAll('[data-lot-tab]'));
  const lotPanes = Array.from(document.querySelectorAll('[data-lot-pane]'));

  function setLotTab(t) {
    lotBtns.forEach(b => b.classList.toggle('is-active', b.dataset.lotTab === t));
    lotPanes.forEach(p => p.classList.toggle('is-active', p.dataset.lotPane === t));
    try { localStorage.setItem(LS_LOT, t); } catch (_) {}
  }
  function getLotTab() { try { return localStorage.getItem(LS_LOT) || 'active'; } catch (_) { return 'active'; } }

  lotBtns.forEach(b => b.addEventListener('click', () => setLotTab(b.dataset.lotTab)));
  setLotTab(getLotTab());

  window.__gg_setLotteryTab = setLotTab;
  window.__gg_getLotteryTab = getLotTab;

})();
</script>
<script defer src="/gg-linker.js"></script>
</body>
</html>
