<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>GGRoom ‚Äî –õ–æ–±–±–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0f14; color:#e6e9ef; }
    .wrap { max-width:960px; margin:0 auto; padding:24px; }
    .top { display:flex; align-items:center; gap:10px; margin-bottom:16px; }
    .pill { display:inline-flex; padding:6px 10px; border-radius:999px; background:#162031; border:1px solid #223149; color:#9fb0c5; font-size:13px; }
    .card { background:#111826; border:1px solid #1f2a3a; border-radius:16px; padding:24px; box-shadow: 0 5px 30px rgba(0,0,0,.25); }
    h1 { font-size:24px; margin:0 0 12px; }
    .btn { display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:12px;
      background:#1b2433; border:1px solid #2a3952; color:#e6e9ef; text-decoration:none; cursor:pointer; }
    .btn:hover { background:#223048; }
    .muted { color:#8ea1b5; }
    .nav a { color:#9fc6ff; text-decoration:none; }
    .nav a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <a class="nav" href="/" style="text-decoration:none">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
      <span class="pill">GG <b>ROOM</b> ‚Äî –õ–æ–±–±–∏</span>
      <div class="pill" id="balance">‚ÇΩ 0</div>
    </div>

    <div class="card">
      <h1 id="hello">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ª–æ–±–±–∏.</h1>
      <p class="muted">–¢—É—Ç –±—É–¥—É—Ç –∫–æ–º–Ω–∞—Ç—ã, —Ç—É—Ä–Ω–∏—Ä—ã –∏ –ø—Ä–æ—á–∞—è –∫—Ä–∞—Å–æ—Ç–∞.</p>
      <p class="muted">–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: <span id="prov">‚Äî</span></p>
      <div style="display:flex; gap:10px; margin-top:8px">
        <button id="btnDeposit" class="btn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        <a class="btn" href="/admin/">–ê–¥–º–∏–Ω–∫–∞</a>
      </div>
    </div>
  </div>

  <script>
    const API = 'https://vercel2pr.onrender.com';
    const DEVICE_ID_KEY = 'gg_device_id';
    function ensureDeviceId() {
      let did = localStorage.getItem(DEVICE_ID_KEY);
      if (!did) { did = crypto.randomUUID?.() || 'guest-' + Math.random().toString(36).slice(2); localStorage.setItem(DEVICE_ID_KEY, did); }
      return did;
    }
    const DEVICE_ID = ensureDeviceId();

    async function api(path, opts={}) {
      const res = await fetch(API + path, {
        method: opts.method || 'GET',
        headers: Object.assign({'x-device-id': DEVICE_ID}, opts.headers || {}),
        body: opts.body || null,
        credentials: 'include',
      });
      const ct = res.headers.get('content-type') || '';
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return ct.includes('application/json') ? res.json() : res.text();
    }

    (async () => {
      try {
        const { ok, user, provider } = await api('/api/me');
        const hello = document.getElementById('hello');
        const prov = document.getElementById('prov');
        const bal  = document.getElementById('balance');
        if (ok && user) {
          const name = [user.first_name, user.last_name].filter(Boolean).join(' ') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
          hello.textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}!`;
          prov.textContent = (provider || '‚Äî').toUpperCase();
          bal.textContent  = `‚ÇΩ ${user.balance ?? 0}`;
        } else {
          hello.textContent = '–í—ã –≤ –≥–æ—Å—Ç–µ–≤–æ–º —Ä–µ–∂–∏–º–µ.';
          prov.textContent = '‚Äî';
        }
      } catch (e) {
        console.error(e);
      }
    })();

    // –ó–∞–≥–ª—É—à–∫–∞ ¬´–ü–æ–ø–æ–ª–Ω–∏—Ç—å¬ª
    document.getElementById('btnDeposit').addEventListener('click', () => {
      alert('–û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º üôÇ');
    });
  </script>
</body>
</html>
