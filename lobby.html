<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Бэкенд и ID бота -->
  <meta name="api-base" content="https://vercel2pr.onrender.com">
  <meta name="tg-bot-id" content="8236271394">

  <title>GG ROOM — Лобби</title>

  <!-- FAVICONS -->
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="manifest" href="/assets/site.webmanifest">

  <!-- UI tokens (единая палитра/радиусы/тени) -->
  <link rel="stylesheet" href="/css/ui-tokens.css">

  <style>
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }

    /* =========================
   TopBar (покерный стиль)
   ========================= */
.hdr{
  position:sticky; top:0; z-index:50;
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg, rgba(15,19,27,.96), rgba(11,13,18,.96));
  backdrop-filter: blur(10px);
}
.hdr-left{ display:flex; align-items:center; gap:12px; min-width:0; }
.hdr-brand{
  display:flex; align-items:baseline; gap:8px;
  font-weight:900; letter-spacing:.3px;
  white-space:nowrap;
}
.hdr-brand .gg{
  background:linear-gradient(90deg,#ff3b3b,#2dd4bf);
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.hdr-brand .room{ color:var(--text); opacity:.92; }
.hdr-title{ color:var(--muted); font-weight:700; white-space:nowrap; }

.hdr-nav{
  display:flex; align-items:center; justify-content:center;
  gap:8px; flex:1;
  min-width:180px;
}
.hdr-nav a{
  display:inline-flex; align-items:center; justify-content:center;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  color:var(--muted);
  text-decoration:none;
  background:rgba(18,22,33,.55);
  font-weight:700;
  white-space:nowrap;
}
.hdr-nav a:hover{ filter:brightness(1.08); }
.hdr-nav a.is-active{
  color:var(--text);
  border-color:rgba(45,212,191,.35);
  background:rgba(45,212,191,.10);
}

.hdr-right{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

/* Base UI */
.btn{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#121621;
  color:var(--text);
  text-decoration:none;
  white-space:nowrap;
  cursor:pointer;
  user-select:none;
}
.btn:hover{ filter:brightness(1.06); }
.btn.primary{
  background:linear-gradient(180deg,#1b2234,#121621);
  border-color:rgba(244,216,138,.35);
  color:var(--gold);
}
.btn.ghost{
  background:rgba(18,22,33,.55);
}

.pill{
  display:inline-flex; align-items:center; gap:6px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid var(--border);
  background:rgba(18,22,33,.55);
  color:var(--text);
  font-weight:800;
}
.hdr-user{
  display:flex; align-items:center; gap:10px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background:rgba(18,22,33,.55);
  min-width:0;
}
.hdr-user img{ width:34px; height:34px; border-radius:50%; object-fit:cover; background:#222; }
.hdr-user .name{ display:flex; flex-direction:column; min-width:0; }
.hdr-user .name strong{ font-size:13px; line-height:1.1; max-width:220px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.hdr-user .name span{ font-size:12px; color:var(--muted); line-height:1.1; }

@media (max-width: 980px){
  .hdr{ flex-wrap:wrap; }
  .hdr-nav{ order:3; width:100%; justify-content:flex-start; }
  .hdr-right{ width:100%; justify-content:space-between; }
  .hdr-user .name strong{ max-width:160px; }
}
@media (max-width: 420px){
  .hdr-title{ display:none; }
}

    .wrap{ max-width:1280px; margin:0 auto; padding:18px 16px }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px }
    /* =========================
       Layout (Sidebar / Main / Right rail)
       ========================= */
    html{ scroll-behavior:smooth; }

    .layout{
      display:grid;
      grid-template-columns: 260px minmax(0,1fr) 320px;
      gap:14px;
      align-items:start;
    }
    .sidebar, .rail{
      position:sticky;
      top:74px; /* высота topbar + небольшой отступ */
      align-self:start;
    }
    .main{ min-width:0; }

    .side-card{ padding:14px; }
    .side-title{ font-weight:900; margin:0 0 10px; font-size:14px; letter-spacing:.2px; color:var(--text); }
    .side-nav{ display:flex; flex-direction:column; gap:8px; }
    .side-link{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(18,22,33,.55);
      color:var(--text);
      text-decoration:none;
      font-weight:800;
    }
    .side-link span{ color:var(--muted); font-weight:700; }
    .side-link:hover{ filter:brightness(1.06); }
    .side-link.is-active{
      border-color:rgba(45,212,191,.35);
      background:rgba(45,212,191,.10);
    }

    .rail .card{ padding:14px; }
    .rail h3{ margin:0 0 8px; font-size:14px; font-weight:900; letter-spacing:.2px; }
    .rail .small{ font-size:13px; color:var(--muted); line-height:1.4; }
    .rail .kpi{
      display:grid; grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .rail .kpi .k{ padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:#0c1018; }
    .rail .kpi .k .t{ font-size:12px; color:var(--muted); }
    .rail .kpi .k .v{ font-size:16px; font-weight:900; margin-top:4px; }

    @media (max-width: 1180px){
      .layout{ grid-template-columns: 240px minmax(0,1fr); }
      .rail{ position:static; }
    }
    @media (max-width: 900px){
      .layout{ grid-template-columns: 1fr; }
      .sidebar{ position:static; }
      .rail{ position:static; }
    }


    /* --- duels (1v1) --- */
    .grid{ display:grid; grid-template-columns:1fr; gap:14px; }
    .card h2{ margin:0 0 10px; font-size:18px; }
    .muted{ color:var(--muted); }

    .duels-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .duels-head .right{ display:flex; align-items:center; gap:8px; }

    .btn.primary{ background:linear-gradient(180deg,#1b2234,#121621); border-color:rgba(244,216,138,.35); color:var(--gold); }
    .btn.primary:hover{ filter:brightness(1.05); }
    .btn.danger{ border-color:rgba(255,59,59,.35); color:#ffb3b3; }

    .duels-create{ border-top:1px dashed var(--border); margin-top:12px; padding-top:12px; }
    .stakes{ display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 10px; }
    .stake-chip{ padding:7px 10px; border-radius:999px; border:1px solid var(--border); background:#121621; color:#e8eaf0; cursor:pointer; font-weight:700; }
    .stake-chip:hover{ filter:brightness(1.06); }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .row input{
      width:160px; max-width:100%; padding:10px 12px;
      border-radius:12px; border:1px solid var(--border);
      background:#0b0f18; color:var(--text);
      outline:none;
    }
    .row input:focus{ border-color:rgba(244,216,138,.45); }
    .hint{ margin-top:8px; font-size:13px; color:var(--muted); }

    .duels-list{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:12px; }
    .duel-item{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px; border-radius:14px; border:1px solid var(--border); background:#0c1018; }
    .duel-left{ display:flex; align-items:center; gap:10px; min-width:0; }
    .duel-left img{ width:38px; height:38px; border-radius:12px; object-fit:cover; background:#222; }
    .duel-title{ font-weight:800; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .duel-sub{ font-size:12px; color:var(--muted); }
    .duel-actions{ display:flex; align-items:center; gap:8px; }

    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:#0f1219; border:1px solid var(--border); border-radius:14px;
      padding:12px 14px; max-width:min(560px, calc(100vw - 24px));
      box-shadow:0 12px 30px rgba(0,0,0,.4);
      z-index:9999; display:none;
    }
    .toast.show{ display:block; }
    .toast .t{ font-weight:800; margin-bottom:4px; }
    .toast .b{ color:var(--muted); font-size:13px; }

    /* бренд-вид кнопок рядом с балансом */
    .hdr-user .btn.vk { background:#2787F5; border-color:#2787F5; color:#fff; }
    .hdr-user .btn.tg { background:#229ED9; border-color:#229ED9; color:#fff; }
    .hdr-user .btn.vk:hover, .hdr-user .btn.tg:hover { filter:brightness(1.05); }

    /* на всякий случай вырубаем старый блок линковок, если где-то остался */
    #link-actions{ display:none !important; }
  

.section-title{ margin-top:14px; display:flex; align-items:baseline; justify-content:space-between; gap:10px; }
.section-title .h3{ font-size:18px; font-weight:700; }
.history-list{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px; }
.history-item{ cursor:pointer; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:#0c1018; display:flex; align-items:center; justify-content:space-between; gap:10px; }
.history-left{ display:flex; flex-direction:column; gap:2px; }
.history-right{ text-align:right; display:flex; flex-direction:column; gap:2px; }
.pill{ display:inline-flex; align-items:center; padding:2px 8px; border-radius:999px; border:1px solid var(--border); font-size:12px; color:var(--muted); }
.pill.win{ color:#4ed1a9; border-color:rgba(78,209,169,.35); }
.pill.lose{ color:#ff6b6b; border-color:rgba(255,107,107,.35); }
.pill.cancel{ color:#c7c7c7; border-color:rgba(199,199,199,.25); }

/* modal */
.modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:9999; padding:18px; }
.modal{ width:min(720px, 100%); border-radius:18px; border:1px solid var(--border); background:#0b0f18; box-shadow:0 20px 60px rgba(0,0,0,.5); }
.modal-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.06); }
.modal-title{ font-weight:800; }
.modal-close{ cursor:pointer; border:1px solid var(--border); background:#0c1018; color:var(--text); padding:6px 10px; border-radius:10px; }
.modal-body{ padding:14px 16px; color:var(--text); }
.kv{ display:grid; grid-template-columns: 160px 1fr; gap:8px 12px; font-size:14px; }
.kv .k{ color:var(--muted); }
.kv .v{ color:var(--text); overflow-wrap:anywhere; }

/* coin overlay */
.coin-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.70); display:none; align-items:center; justify-content:center; z-index:10000; }
.coin-card{ width:min(520px, 92vw); border-radius:18px; border:1px solid var(--border); background:#0b0f18; padding:18px; text-align:center; }
.coin{ width:90px; height:90px; margin:10px auto 12px; border-radius:50%; border:2px solid rgba(255,215,0,.55); background:radial-gradient(circle at 30% 30%, rgba(255,215,0,.95), rgba(255,215,0,.25)); animation: coinFlip 1.05s linear infinite; }
.coin-text{ font-size:15px; color:var(--muted); }
@keyframes coinFlip{ 0%{ transform:rotateY(0deg) rotateX(0deg); } 50%{ transform:rotateY(180deg) rotateX(14deg); } 100%{ transform:rotateY(360deg) rotateX(0deg); } }
</style>
</head>
<body>
  <header class="hdr">
  <div class="hdr-left">
    <a class="btn hdr-back" href="/index.html" title="На главную">
      <span aria-hidden="true">←</span>
      <span class="label">На главную</span>
    </a>

    <div class="hdr-brand" aria-label="GGROOM">
      <span class="gg">GG</span><span class="room">ROOM</span>
    </div>
    <div class="hdr-title">Лобби</div>
  </div>

  <nav class="hdr-nav" aria-label="Навигация">
    <a href="#stakes" class="is-active">Ставки</a>
    <a href="#live">Live</a>
    <a href="#archive">Архив</a>
  </nav>

  <div class="hdr-right">
    <span class="pill" id="user-balance">
      ₿ <span class="balance-amount" data-balance="">0</span>
    </span>

    <a class="btn primary" href="#" id="topup-btn" title="Пополнить баланс">Пополнить</a>

    <button class="btn ghost" id="link-tg" style="display:none" type="button">Связать Telegram</button>
    <button class="btn ghost" id="link-vk" style="display:none" type="button">Связать ВКонтакте</button>

    <div class="hdr-user">
      <img id="user-avatar" alt="avatar" referrerpolicy="no-referrer" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Crect width='80' height='80' rx='40' fill='%23222'/%3E%3Ctext x='40' y='48' text-anchor='middle' font-size='28' fill='%23aaa' font-family='Arial'%3EGG%3C/text%3E%3C/svg%3E">
      <div class="name">
        <strong id="user-name-text">Гость</strong>
        <span>Профиль</span>
      </div>
    </div>
  </div>
</header>


  <div class="wrap">
    <div class="layout">
      <aside class="sidebar" aria-label="Боковая панель">
        <div class="card side-card">
          <h3 class="side-title">Навигация</h3>
          <nav class="side-nav">
            <a class="side-link" href="#stakes">Ставки <span>создать</span></a>
            <a class="side-link" href="#live">Live <span>комнаты</span></a>
            <a class="side-link" href="#archive">Архив <span>история</span></a>
          </nav>
        </div>

        <div class="card side-card" style="margin-top:14px">
          <h3 class="side-title">Подсказка</h3>
          <div class="muted" style="font-size:13px; line-height:1.45">
            Выбирай ставку → создай комнату → дождись соперника.
            Победителя определяет coinflip. Детали дуэли можно открыть по клику в истории.
          </div>
        </div>
      </aside>

      <main class="main" aria-label="Основной контент">
        <div class="grid">

      <div class="card">
        <p style="margin:0">Добро пожаловать в лобби.</p>
        <p id="provider-note" style="margin:8px 0 0; color:var(--muted)"></p>
      </div>

      <div class="card" id="duels-card">
        <div id="stakes" class="duels-head">
          <h2 style="margin:0">Дуэли 1v1</h2>
          <div class="right">
            <button class="btn" id="duels-refresh" type="button">Обновить</button>
          </div>
        </div>

        <div class="duels-create">
          <div class="muted" style="font-size:13px">
            Создай комнату со ставкой — второй игрок заходит, и система честно кидает монету (coinflip).
          </div>

          <div class="stakes" aria-label="Быстрые ставки">
            <button class="stake-chip" data-stake="100" type="button">₽100</button>
            <button class="stake-chip" data-stake="250" type="button">₽250</button>
            <button class="stake-chip" data-stake="500" type="button">₽500</button>
            <button class="stake-chip" data-stake="1000" type="button">₽1 000</button>
            <button class="stake-chip" data-stake="2500" type="button">₽2 500</button>
          </div>

          <div class="row">
            <input id="stake-input" inputmode="numeric" type="number" min="10" max="1000000" step="10" value="100" />
            <button class="btn primary" id="duels-create" type="button">Создать комнату</button>
          </div>
          <div class="hint" id="duels-hint">Комиссия сейчас фиксированная: 5% (пока только в логе). Скоро подключим «дом».</div>
        </div>

        <div id="live"></div>
   <div class="duels-list" id="duels-list">
  <div class="muted">Загружаю комнаты…</div>
</div>

<div id="archive"></div>
   <div class="section-title">
  <div class="h3">История</div>
  <div class="muted">последние игры</div>
</div>
<div class="history-list" id="history-list">
  <div class="muted">Загружаю историю…</div>
</div>
      </div>

        </div>
      </main>

      <aside class="rail" aria-label="Правая панель">
        <div class="card">
          <h3>Provably fair</h3>
          <div class="small">
            Каждая дуэль имеет проверяемую «монетку»: commit → reveal → вычисление winner.
            В карточке дуэли можно увидеть seed/nonce/commit и повторить расчёт.
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3>Статус</h3>
          <div class="small">Пока без лишних цифр. Позже сюда добавим онлайн / активные дуэли / частоту игр.</div>
          <div class="kpi" aria-hidden="true">
            <div class="k"><div class="t">Онлайн</div><div class="v">—</div></div>
            <div class="k"><div class="t">Live</div><div class="v">—</div></div>
          </div>
        </div>
      </aside>
    </div>
  </div>


<!-- Детали дуэли -->

<div class="modal-backdrop" id="duel-modal">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="duel-modal-title">Дуэль</div>
      <button class="modal-close" id="duel-modal-close">Закрыть</button>
    </div>
    <div class="modal-body">
      <div class="kv" id="duel-modal-kv"></div>
    </div>
  </div>
</div>

<!-- Монетка (3–4 секунды) -->
<div class="coin-overlay" id="coin-overlay">
  <div class="coin-card">
    <div style="font-weight:800; font-size:18px;">Монетка решает судьбу…</div>
    <div class="coin" aria-hidden="true"></div>
    <div class="coin-text">Секунду. Мы честно кидаем coinflip.</div>
  </div>
</div>

  <div class="toast" id="toast">
    <div class="t" id="toast-title"></div>
    <div class="b" id="toast-body"></div>
  </div>

  <!-- Telegram Login (асинхронно) -->
  <script async src="https://telegram.org/js/telegram-widget.js?22"></script>

  <!-- Весь JS — в одном файле. Он тянет HUM-баланс, делает proof-link и меняет кнопку на «… связан». -->
  <script src="/js/lobby-balance-fix.js"></script>

  <!-- Дуэли 1v1: список, создание, join/cancel -->
  <script src="/js/duels-lobby.js?v=6"></script>


  <script>
    // Подсветка активной вкладки (topbar + sidebar) по hash
    (function(){
      const topLinks = Array.from(document.querySelectorAll('.hdr-nav a'));
      const sideLinks = Array.from(document.querySelectorAll('.side-nav a'));
      function norm(h){ return (h && h.startsWith('#')) ? h : '#stakes'; }
      function update(){
        const h = norm(location.hash || '#stakes');
        topLinks.forEach(a => a.classList.toggle('is-active', a.getAttribute('href') === h));
        sideLinks.forEach(a => a.classList.toggle('is-active', a.getAttribute('href') === h));
      }
      window.addEventListener('hashchange', update);
      update();
    })();
  </script>

  <script defer src="/gg-linker.js"></script>
</body>
</html>
