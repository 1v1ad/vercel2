<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GG Room ‚Äî –õ–æ–±–±–∏</title>
  <style>
    :root{
      --bg:#0b0d12; --card:#0f1219; --text:#e8eaf0; --muted:#98a2b3; --gold:#f4d88a;
      --border:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:#0b0d12; color:var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .hdr{
      display:grid; grid-template-columns: 1fr auto 1fr; gap:10px; align-items:center;
      background:linear-gradient(180deg,#0f131b,#0b0d12); border-bottom:1px solid var(--border); padding:12px;
    }
    .hdr .brand{ font-weight:800; color:var(--gold); text-align:center }
    .hdr .brand .gg{ background: linear-gradient(90deg, #ff3b3b, #23d160); -webkit-background-clip:text; background-clip:text; color:transparent }
    .hdr .btn{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; border:1px solid var(--border); background:#121621; color:#e8eaf0; text-decoration:none; white-space:nowrap }
    .hdr-back{ grid-area:back }
    .hdr-cta { grid-area:cta }
    .wrap{ max-width:960px; margin:0 auto; padding:18px }
    .card{ border:1px solid var(--border); border-radius:16px; background:linear-gradient(180deg,#0f1219,#0b0d12); padding:18px; margin-top:14px }
    .muted{ color:var(--muted) }
    .row{ display:flex; gap:10px; flex-wrap:wrap }
  </style>
</head>
<body>
  <header class="hdr">
    <a href="/" class="btn hdr-back">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    <div class="brand"><span class="gg">GG</span> ROOM ‚Äî –õ–æ–±–±–∏</div>
    <div class="hdr-cta row">
      <div id="balance" class="btn">‚ÇΩ 0</div>
      <a class="btn" href="/admin/">–ê–¥–º–∏–Ω–∫–∞</a>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <h2 id="hello">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ª–æ–±–±–∏.</h2>
      <p class="muted">–¢—É—Ç –±—É–¥—É—Ç –∫–æ–º–Ω–∞—Ç—ã, —Ç—É—Ä–Ω–∏—Ä—ã –∏ –ø—Ä–æ—á–∞—è –∫—Ä–∞—Å–æ—Ç–∞.</p>
      <p class="muted">–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: <span id="prov">‚Äî</span></p>
      <div class="row" style="margin-top:8px">
        <a href="#" id="topup-btn" class="btn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</a>
      </div>
    </div>
  </main>

  <script>
    const API = 'https://vercel2pr.onrender.com';
    const DEVICE_ID_KEY = 'gg_device_id';
    function ensureDeviceId() {
      let did = localStorage.getItem(DEVICE_ID_KEY);
      if (!did) { did = crypto.randomUUID?.() || 'guest-' + Math.random().toString(36).slice(2); localStorage.setItem(DEVICE_ID_KEY, did); }
      return did;
    }
    const DEVICE_ID = ensureDeviceId();

    async function api(path, opts={}) {
      const res = await fetch(API + path, {
        method: opts.method || 'GET',
        headers: Object.assign({'x-device-id': DEVICE_ID}, opts.headers || {}),
        body: opts.body || null,
        credentials: 'include',
      });
      const ct = res.headers.get('content-type') || '';
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return ct.includes('application/json') ? res.json() : res.text();
    }

    (async () => {
      try {
        const { ok, user, provider } = await api('/api/me');
        const hello = document.getElementById('hello');
        const prov = document.getElementById('prov');
        const bal  = document.getElementById('balance');
        if (ok && user) {
          const name = [user.first_name, user.last_name].filter(Boolean).join(' ') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
          hello.textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}!`;
          prov.textContent = (provider || '‚Äî').toUpperCase();
          bal.textContent  = `‚ÇΩ ${user.balance ?? 0}`;
        } else {
          hello.textContent = '–í—ã –≤ –≥–æ—Å—Ç–µ–≤–æ–º —Ä–µ–∂–∏–º–µ.';
          prov.textContent = '‚Äî';
        }
      } catch (e) {
        console.error(e);
      }
    })();

    document.getElementById('topup-btn').addEventListener('click', (e) => {
      e.preventDefault();
      alert('–û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º üôÇ');
    });
  </script>
</body>
</html>
