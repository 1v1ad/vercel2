<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>VK Callback</title>
  <script src="https://unpkg.com/@vkid/sdk@2.10.0/dist-sdk/umd/index.js"></script>
  <script>
    (async () => {
      try {
        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');
        const deviceId = params.get('device_id');

        if (!code || !deviceId) {
          alert("Ошибка: отсутствует код авторизации.");
          return;
        }

        const VKID = window.VKIDSDK;
        const result = await VKID.Auth.exchangeCode(code, deviceId);
        const user = result.user;

        if (!user || !user.first_name || !user.photo) {
          alert("Ошибка: данные пользователя отсутствуют.");
          return;
        }

        localStorage.setItem("user_first_name", user.first_name);
        localStorage.setItem("user_last_name", user.last_name);
        localStorage.setItem("user_avatar", user.photo);

        window.location.href = "/lobby.html";
      } catch (err) {
        alert("Ошибка авторизации: " + err.message);
      }
    })();
  </script>
</head>
<body></body>
</html>
