<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>VK One Tap Login</title>
</head>
<body>
  <h1>VK One Tap Login</h1>
  <div id="vk_onetap"></div>

  <script src="https://unpkg.com/@vkid/sdk@2.29.2/dist-sdk/umd/index.js"></script>
  <script>
    const VKID = window.VKIDSDK;

    VKID.Config.init({
      app: 53969710,
      redirectUrl: 'https://vercel2-eight-blue.vercel.app/api/vk/callback',
      responseMode: VKID.ConfigResponseMode.Callback,
      source: VKID.ConfigSource.LOWCODE,
      scope: '',
    });

    const oneTap = new VKID.OneTap();

    oneTap
      .render({
        container: document.getElementById('vk_onetap'),
        showAlternativeLogin: true,
        oauthList: ['mail_ru']
      })
      .on(VKID.WidgetEvents.ERROR, vkidOnError)
      .on(VKID.OneTapInternalEvents.LOGIN_SUCCESS, payload => {
        const { code, device_id } = payload;

        VKID.Auth.exchangeCode(code, device_id)
          .then(vkidOnSuccess)
          .catch(vkidOnError);
      });

    function vkidOnSuccess(data) {
      console.log('Success', data);
      // window.location.href = '/lobby'; // Если нужно перенаправление
    }

    function vkidOnError(error) {
      console.error('VK ID Error', error);
    }
  </script>
</body>
</html>
