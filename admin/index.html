<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GGRoom — Admin</title>

  <style>
    :root { --bg:#0b1117; --panel:#0f1720; --muted:#8fa4c6; --accent:#22d3ee; --ok:#10b981; --warn:#f59e0b; --err:#ef4444; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:#dbe7ff; font:14px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif; }
    a { color:#9ecbff; text-decoration:none; }
    h1{font-size:18px;margin:0 0 12px 0}
    .wrap { max-width:1100px; margin:0 auto; padding:16px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .card { background:var(--panel); border-radius:12px; padding:14px; flex:1 1 240px; min-width:240px; }
    .card h2{ font-size:13px; color:var(--muted); margin:0 0 6px; font-weight:600; letter-spacing:.02em; }
    .metric{ font-size:28px; font-weight:700; }
    .toolbar { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
    input[type="text"], input[type="password"], input[type="number"] { background:#0a1220; border:1px solid #1f2a36; color:#e6f0ff; border-radius:8px; padding:8px 10px; outline:none; width:100%; }
    input::placeholder{ color:#7d90ad; }
    button { background:#1a2635; color:#e6f0ff; border:1px solid #294055; border-radius:10px; padding:8px 12px; cursor:pointer; }
    button:hover{ background:#213247; }
    .btn-primary { background:#1b3b56; border-color:#1e4c6e; }
    .hint { color:var(--muted); font-size:12px; }
    .right { text-align:right; }
    .space { height:12px; }

    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px 10px; border-bottom:1px solid #182533; vertical-align:middle; }
    th { color:#9bb9e7; text-align:left; font-weight:600; }
    tr:hover td { background:#0d1521; }
    .actions{ display:flex; gap:8px; }

    .grid2 { display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; background:#112030; color:#b6c9e6; font-size:12px; }

    /* канвас под график */
    #visits-chart { width:100%; height:180px; display:block; background:#0c151f; border-radius:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <input id="api_url" type="text" placeholder="https://vercel2pr.onrender.com" style="width:360px">
      <input id="admin_pwd" type="password" placeholder="Пароль администратора" style="width:220px">
      <button id="save_btn" class="btn-primary">Сохранить</button>
      <button id="check_btn">Проверка</button>
      <span class="hint">API и пароль сохраняются в localStorage</span>
    </div>

    <!-- верхние метрики -->
    <div class="row">
      <div class="card"><h2>Пользователи</h2><div id="m_users" class="metric">0</div></div>
      <div class="card"><h2>События</h2><div id="m_events" class="metric">0</div></div>
      <div class="card"><h2>Авторизаций (7д)</h2><div id="m_auth7" class="metric">0</div></div>
      <div class="card"><h2>Уникальные (7д)</h2><div id="m_unique7" class="metric">0</div></div>
    </div>

    <div class="space"></div>

    <!-- график -->
    <div class="card" style="min-width:100%">
      <div class="grid2">
        <h2>Аналитика посещений</h2>
        <span class="pill" id="chart-range">7 дней</span>
      </div>
      <canvas id="visits-chart"></canvas>
    </div>

    <div class="space"></div>

    <!-- инструменты -->
    <div class="row">
      <div class="card">
        <h2>Склейка: предложения</h2>
        <div class="grid2">
          <button id="merge_all_btn">Склеить все</button>
          <span class="hint">Укажи API и пароль серверу</span>
        </div>
      </div>

      <div class="card">
        <h2>Пополнение</h2>
        <div class="grid2" style="grid-template-columns:120px 120px auto;">
          <input id="topup_user_id" type="number" placeholder="user_id">
          <input id="topup_amount" type="number" placeholder="сумма">
          <button id="topup_btn">Пополнить вручную</button>
        </div>
      </div>
    </div>

    <div class="space"></div>

    <!-- пользователи -->
    <div class="card" style="min-width:100%">
      <h2>Пользователи</h2>
      <div class="grid2" style="grid-template-columns:1fr auto;">
        <input id="users_search" type="text" placeholder="Поиск (vk_id, имя, фамилия)">
        <button id="users_refresh">Обновить</button>
      </div>
      <div class="space"></div>
      <div style="overflow:auto;">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>VK</th>
              <th>Имя</th>
              <th>Фамилия</th>
              <th class="right">Баланс</th>
              <th>Страна</th>
              <th>Создан</th>
              <th>Провайдеры</th>
            </tr>
          </thead>
          <tbody id="users_tbody"></tbody>
        </table>
      </div>
    </div>

    <div class="space"></div>

    <!-- события -->
    <div class="card" style="min-width:100%">
      <h2>События</h2>
      <div class="row" style="gap:8px">
        <input id="events_type" type="text" placeholder="Тип (login, auth_start, auth_...)">
        <input id="events_user_id" type="number" placeholder="user_id">
        <input id="events_ip" type="text" placeholder="ip">
        <input id="events_ua" type="text" placeholder="ua">
        <button id="events_refresh">Обновить</button>
      </div>
      <div class="space"></div>
      <div style="overflow:auto;">
        <table>
          <thead>
            <tr>
              <th>ID</th><th>user_id</th><th>event_type</th><th>type</th><th>ip</th><th>ua</th><th>Дата</th>
            </tr>
          </thead>
          <tbody id="events_tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- скрипты: shim -> flags -> твой остальной код -->
  <script src="admin-auth-headers.js"></script>
  <script src="flags.js"></script>
  <!-- chart.js оставим подключенным; вернёмся к нему позже -->
  <script src="chart.js"></script>
  <script src="app.js"></script>
  <script src="merge-suggest.js"></script>
  <script src="topup.js"></script>
</body>
</html>
